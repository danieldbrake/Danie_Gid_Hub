function stopAnimation(){done=!0,d3.select("#animate").node().checked=!1}function startAnimation(){done=!1,d3.timer(function(){var e=projection.origin();return e=[e[0]+.18,e[1]+.06],projection.origin(e),circle.origin(e),refresh(),done})}function animationState(){return"animation: "+(done?"off":"on")}function mousedown(){stopAnimation(),m0=[d3.event.pageX,d3.event.pageY],o0=projection.origin(),d3.event.preventDefault()}function mousemove(){if(m0){var e=[d3.event.pageX,d3.event.pageY],n=[o0[0]+(m0[0]-e[0])/8,o0[1]+(e[1]-m0[1])/8];projection.origin(n),circle.origin(n),refresh()}}function mouseup(){m0&&(mousemove(),m0=null)}function refresh(e){(e?feature.transition().duration(e):feature).attr("d",clip)}function clip(e){return path(circle.clip(e))}function reframe(e){for(var n in e)frameElement.style[n]=e[n]+"px"}function handleFileSelect(){var e=d3.event,n=e.dataTransfer.files,t=[],o=null;e.stopPropagation(),e.preventDefault();for(var r=0,a;a=n[r];r++)readGeojson(a,draw)}function readGeojson(e,n){var t=new FileReader;t.onload=function(t){n(t.target.result,e)},t.readAsText(e)}function handleDragOver(){var e=d3.event;e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}function draw(e,n){var t=JSON.parse(e),o=t.features;feature.data(countries=countries.features.concat(o)).enter().append("svg:path").classed("new",!0).attr("id",function(e){return e.id}).attr("d",clip),feature=svg.selectAll("path"),refresh()}var feature,countries,projection=d3.geo.azimuthal().scale(250).origin([-71.03,42.37]).mode("orthographic").translate([250,250]),circle=d3.geo.greatCircle().origin(projection.origin()),scale={orthographic:250,stereographic:250,gnomonic:250,equidistant:250/Math.PI*2,equalarea:250/Math.SQRT2},path=d3.geo.path().projection(projection),svg=d3.select("#canvas_globe_svg").on("mousedown",mousedown);frameElement&&(frameElement.style.height="800px"),d3.json("json/world-countries.json",function(e){countries=e,feature=svg.selectAll("path").data(e.features).enter().append("#canvas_glove_svg:path").attr("id",function(e){return e.id}).attr("d",clip),feature.append("#canvas_glove_svg:title").text(function(e){return e.properties.name})}),d3.select(window).on("mousemove",mousemove).on("mouseup",mouseup),d3.select("select").on("change",function(){stopAnimation(),projection.mode(this.value).scale(scale[this.value]),refresh(750)});var m0,o0,done;d3.select("svg#canvas_globe_svg").on("dragover",handleDragOver).on("drop",handleFileSelect);